<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<style>
		*{margin:0px;padding:0px;}
		canvas{background:black;}
	</style>
	<script type="text/javascript" src="dat.gui.min.js"></script>
	<script type="text/javascript" src="Jenjens.js"></script>
	<script type="text/javascript" src="Jenjens-alias.js"></script>
</head>
<body>
	<script>
		var System=function(){
			//render settings
			this.iterationDelay=100;
			this.renderType='normal';
			this.fade=false;
			this.fadeAlpha=0.05;

			//tmp for testing
			this.bodies=[];
			//this.bodies[0]=new Body(70,[255,0,0,0.5],'star');
			//this.bodies[1]=new Body(4,[0,255,0,0.5],'planet',200);
			//this.bodies[2]=new Body(1,[0,255,255,0.8],'asteroid thing',500);
			//physics.setOrbit(this.bodies[0],this.bodies[1]);
			this.bodies[0]=new Body(200,[255,0,0,0.5],'alpha');
			this.bodies[1]=new Body(10,[0,0,255,1],'bravo',10000,1e27);
			this.bodies[2]=new Body(0,[255,255,0,1],'I HAVE A NAME!!',29,3000);

			//get canvas
			this.canvas=document.getElementById('canvas');
			this.canvas.width=window.innerWidth;
			this.canvas.height=window.innerHeight;
			this.context=this.canvas.getContext('2d');

			this.generateNewSystem=function(){
				//generates new bodies
			};
			this.loop=function(){
				forEachCompare(this.bodies,function(a,b){physics.applyGravity(a,b);});
				forEach(this.bodies,function(b){physics.updateLocation(b);});
				forEach(this.bodies,function(b){
					sys.context.beginPath();
					sys.context.arc(b.x,b.y,b.radius,0,Math.Tau);
					sys.context.fillStyle='rgba('+b.color[0]+','+b.color[1]+','+b.color[2]+','+b.color[3]+')';
					sys.context.fill();
				});
			}
		};
		var Body=function(radius,color,name,x,y){
			Circle.call(this,radius,x,y,color);
			this.v=new physics.vector();

			radius? this.radius=radius : this.radius=1;
			//color? this.color=color : this.color=[1,1,1,1];
			name? this.name=name : this.name='unnamed';
			//x? this.x=x : this.x=0;
			//y? this.y=y : this.y=0;
			this.mass=Math.pow(this.radius,2.7);
		};

		window.onload=function(){
			//Create the System & GUI
			/*var*/ sys=new System();
			/*var*/ gui=new dat.GUI();
			gui.add(sys,'generateNewSystem');

			//Render Settings
			var f1=gui.addFolder('Render Settings');
			f1.add(sys,'iterationDelay',{Max:1,fps_60:16,fps_30:33,fps_10:100,Min:2000});
			f1.add(sys,'renderType',{normal:'normal',pseudo_3D:'3D',sideView:'side'});
			f1.add(sys,'fade');
			f1.add(sys,'fadeAlpha',0.01,1).step(0.01);

			//Bodies
			var f2=gui.addFolder('Bodies');
			var a=[];
			forEach(sys.bodies,function(b){
				a.push(f2.addFolder(b.name));
				a[a.length-1].add(b,'name');
				a[a.length-1].addColor(b,'color');
				a[a.length-1].add(b,'mass');
				a[a.length-1].add(b,'radius');
				a[a.length-1].add(b,'x');
				a[a.length-1].add(b,'y');
				a.push(a[a.length-1].addFolder('Velocity'));
				a[a.length-1].add(b.v,'x');
				a[a.length-1].add(b.v,'y');
			});

			gui.remember(sys); //bugged?

			//update dat.GUI elements every second
			setInterval(function(){
				for (var i in gui.__controllers){
					gui.__controllers[i].updateDisplay();
				}
			},1000);
			//And finally, START
			//sys.loop();
			//setTimeout(this.loop.call(this),this.iterationDelay);
			setInterval(sys.loop,sys.iterationDelay);
		}
	</script>
	<canvas id="canvas"></canvas>
</body>
</html>
