var dat=dat||{};dat.gui=dat.gui||{};dat.utils=dat.utils||{};dat.controllers=dat.controllers||{};dat.dom=dat.dom||{};dat.color=dat.color||{};dat.utils.css=function(){return{load:function(e,t){t=t||document;var n=t.createElement("link");n.type="text/css";n.rel="stylesheet";n.href=e;t.getElementsByTagName("head")[0].appendChild(n)},inject:function(e,t){t=t||document;var n=document.createElement("style");n.type="text/css";n.innerHTML=e;t.getElementsByTagName("head")[0].appendChild(n)}}}();dat.utils.common=function(){var e=Array.prototype.forEach,t=Array.prototype.slice;return{BREAK:{},extend:function(e){this.each(t.call(arguments,1),function(t){for(var n in t)this.isUndefined(t[n])||(e[n]=t[n])},this);return e},defaults:function(e){this.each(t.call(arguments,1),function(t){for(var n in t)this.isUndefined(e[n])&&(e[n]=t[n])},this);return e},compose:function(){var e=t.call(arguments);return function(){for(var n=t.call(arguments),i=e.length-1;0<=i;i--)n=[e[i].apply(this,n)];return n[0]}},each:function(t,n,i){if(e&&t.forEach===e)t.forEach(n,i);else if(t.length===t.length+0)for(var r=0,o=t.length;r<o&&!(r in t&&n.call(i,t[r],r)===this.BREAK);r++);else for(r in t)if(n.call(i,t[r],r)===this.BREAK)break},defer:function(e){setTimeout(e,0)},toArray:function(e){return e.toArray?e.toArray():t.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){return e!==e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}}}();dat.controllers.Controller=function(e){var t=function(e,t){this.initialValue=e[t];this.domElement=document.createElement("div");this.object=e;this.property=t;this.__onFinishChange=this.__onChange=void 0};e.extend(t.prototype,{onChange:function(e){this.__onChange=e;return this},onFinishChange:function(e){this.__onFinishChange=e;return this},setValue:function(e){this.object[this.property]=e;this.__onChange&&this.__onChange.call(this,e);this.updateDisplay();return this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}});return t}(dat.utils.common);dat.dom.dom=function(e){function t(t){if("0"===t||e.isUndefined(t))return 0;t=t.match(i);return e.isNull(t)?0:parseFloat(t[1])}var n={};e.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(t,i){e.each(t,function(e){n[e]=i})});var i=/(\d+(\.\d+)?)px/,r={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(t,n,i){e.isUndefined(n)&&(n=!0);e.isUndefined(i)&&(i=!0);t.style.position="absolute";n&&(t.style.left=0,t.style.right=0);i&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,i,r,o){r=r||{};var s=n[i];if(!s)throw Error("Event type "+i+" not supported.");var a=document.createEvent(s);switch(s){case"MouseEvents":a.initMouseEvent(i,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,r.x||r.clientX||0,r.y||r.clientY||0,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":s=a.initKeyboardEvent||a.initKeyEvent;e.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0});s(i,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break;default:a.initEvent(i,r.bubbles||!1,r.cancelable||!0)}e.defaults(a,o);t.dispatchEvent(a)},bind:function(e,t,n,i){e.addEventListener?e.addEventListener(t,n,i||!1):e.attachEvent&&e.attachEvent("on"+t,n);return r},unbind:function(e,t,n,i){e.removeEventListener?e.removeEventListener(t,n,i||!1):e.detachEvent&&e.detachEvent("on"+t,n);return r},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1==n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return r},removeClass:function(e,t){if(t){if(void 0!==e.className)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),i=n.indexOf(t);-1!=i&&(n.splice(i,1),e.className=n.join(" "))}}else e.className=void 0;return r},hasClass:function(e,t){return RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){e=getComputedStyle(e);return t(e["border-left-width"])+t(e["border-right-width"])+t(e["padding-left"])+t(e["padding-right"])+t(e.width)},getHeight:function(e){e=getComputedStyle(e);return t(e["border-top-width"])+t(e["border-bottom-width"])+t(e["padding-top"])+t(e["padding-bottom"])+t(e.height)},getOffset:function(e){var t={left:0,top:0};if(e.offsetParent){do t.left+=e.offsetLeft,t.top+=e.offsetTop;while(e=e.offsetParent)}return t},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}};return r}(dat.utils.common);dat.controllers.OptionController=function(e,t,n){var i=function(e,r,o){i.superclass.call(this,e,r);var s=this;this.__select=document.createElement("select");if(n.isArray(o)){var a={};n.each(o,function(e){a[e]=e});o=a}n.each(o,function(e,t){var n=document.createElement("option");n.innerHTML=t;n.setAttribute("value",e);s.__select.appendChild(n)});this.updateDisplay();t.bind(this.__select,"change",function(){s.setValue(this.options[this.selectedIndex].value)});this.domElement.appendChild(this.__select)};i.superclass=e;n.extend(i.prototype,e.prototype,{setValue:function(e){e=i.superclass.prototype.setValue.call(this,e);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());return e},updateDisplay:function(){this.__select.value=this.getValue();return i.superclass.prototype.updateDisplay.call(this)}});return i}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);dat.controllers.NumberController=function(e,t){var n=function(e,i,r){n.superclass.call(this,e,i);r=r||{};this.__min=r.min;this.__max=r.max;this.__step=r.step;t.isUndefined(this.__step)?this.__impliedStep=0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__impliedStep=this.__step;e=this.__impliedStep;e=e.toString();e=-1<e.indexOf(".")?e.length-e.indexOf(".")-1:0;this.__precision=e};n.superclass=e;t.extend(n.prototype,e.prototype,{setValue:function(e){void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max);void 0!==this.__step&&0!=e%this.__step&&(e=Math.round(e/this.__step)*this.__step);return n.superclass.prototype.setValue.call(this,e)},min:function(e){this.__min=e;return this},max:function(e){this.__max=e;return this},step:function(e){this.__step=e;return this}});return n}(dat.controllers.Controller,dat.utils.common);dat.controllers.NumberControllerBox=function(e,t,n){var i=function(e,r,o){function s(){var e=parseFloat(l.__input.value);n.isNaN(e)||l.setValue(e)}function a(e){var t=c-e.clientY;l.setValue(l.getValue()+t*l.__impliedStep);c=e.clientY}function d(){t.unbind(window,"mousemove",a);t.unbind(window,"mouseup",d)}this.__truncationSuspended=!1;i.superclass.call(this,e,r,o);var l=this,c;this.__input=document.createElement("input");this.__input.setAttribute("type","text");t.bind(this.__input,"change",s);t.bind(this.__input,"blur",function(){s();l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())});t.bind(this.__input,"mousedown",function(e){t.bind(window,"mousemove",a);t.bind(window,"mouseup",d);c=e.clientY});t.bind(this.__input,"keydown",function(e){13===e.keyCode&&(l.__truncationSuspended=!0,this.blur(),l.__truncationSuspended=!1)});this.updateDisplay();this.domElement.appendChild(this.__input)};i.superclass=e;n.extend(i.prototype,e.prototype,{updateDisplay:function(){var e=this.__input,t;if(this.__truncationSuspended)t=this.getValue();else{t=this.getValue();var n=Math.pow(10,this.__precision);t=Math.round(t*n)/n}e.value=t;return i.superclass.prototype.updateDisplay.call(this)}});return i}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common);dat.controllers.NumberControllerSlider=function(e,t,n,i,r){function o(e,t,n,i,r){return i+(e-t)/(n-t)*(r-i)}var s=function(e,n,i,r,a){function d(e){e.preventDefault();var n=t.getOffset(c.__background),i=t.getWidth(c.__background);c.setValue(o(e.clientX,n.left,n.left+i,c.__min,c.__max));return!1}function l(){t.unbind(window,"mousemove",d);t.unbind(window,"mouseup",l);c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}s.superclass.call(this,e,n,{min:i,max:r,step:a});var c=this;this.__background=document.createElement("div");this.__foreground=document.createElement("div");t.bind(this.__background,"mousedown",function(e){t.bind(window,"mousemove",d);t.bind(window,"mouseup",l);d(e)});t.addClass(this.__background,"slider");t.addClass(this.__foreground,"slider-fg");this.updateDisplay();this.__background.appendChild(this.__foreground);this.domElement.appendChild(this.__background)};s.superclass=e;s.useDefaultStyles=function(){n.inject(r)};i.extend(s.prototype,e.prototype,{updateDisplay:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);this.__foreground.style.width=100*e+"%";return s.superclass.prototype.updateDisplay.call(this)}});return s}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,"/**\n * dat-gui JavaScript Controller Library\n * http://code.google.com/p/dat-gui\n *\n * Copyright 2011 Data Arts Team, Google Creative Lab\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n */\n\n.slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}");dat.controllers.FunctionController=function(e,t,n){var i=function(e,n,r){i.superclass.call(this,e,n);var o=this;this.__button=document.createElement("div");this.__button.innerHTML=void 0===r?"Fire":r;t.bind(this.__button,"click",function(e){e.preventDefault();o.fire();return!1});t.addClass(this.__button,"button");this.domElement.appendChild(this.__button)};i.superclass=e;n.extend(i.prototype,e.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());this.getValue().call(this.object)}});return i}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);dat.controllers.BooleanController=function(e,t,n){var i=function(e,n){i.superclass.call(this,e,n);var r=this;this.__prev=this.getValue();this.__checkbox=document.createElement("input");this.__checkbox.setAttribute("type","checkbox");t.bind(this.__checkbox,"change",function(){r.setValue(!r.__prev)},!1);this.domElement.appendChild(this.__checkbox);this.updateDisplay()};i.superclass=e;n.extend(i.prototype,e.prototype,{setValue:function(e){e=i.superclass.prototype.setValue.call(this,e);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());this.__prev=this.getValue();return e},updateDisplay:function(){!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1;return i.superclass.prototype.updateDisplay.call(this)}});return i}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);dat.color.toString=function(e){return function(t){if(1==t.a||e.isUndefined(t.a)){for(t=t.hex.toString(16);6>t.length;)t="0"+t;return"#"+t}return"rgba("+Math.round(t.r)+","+Math.round(t.g)+","+Math.round(t.b)+","+t.a+")"}}(dat.utils.common);dat.color.interpret=function(e,t){var n,i,r=[{litmus:t.isString,conversions:{THREE_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null===e?!1:{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString())}},write:e},SIX_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9]{6})$/i);return null===e?!1:{space:"HEX",hex:parseInt("0x"+e[1].toString())}},write:e},CSS_RGB:{read:function(e){e=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null===e?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:e},CSS_RGBA:{read:function(e){e=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null===e?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:e}}},{litmus:t.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:t.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3!=e.length?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4!=e.length?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:t.isObject,conversions:{RGBA_OBJ:{read:function(e){return t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)&&t.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)&&t.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}];return function(){i=!1;var e=1<arguments.length?t.toArray(arguments):arguments[0];t.each(r,function(r){if(r.litmus(e))return t.each(r.conversions,function(r,o){n=r.read(e);if(!1===i&&!1!==n)return i=n,n.conversionName=o,n.conversion=r,t.BREAK}),t.BREAK});return i}}(dat.color.toString,dat.utils.common);dat.GUI=dat.gui.GUI=function(e,t,n,i,r,o,s,a,d,l,c,u,h,f,m){function p(e,t,n,o){if(void 0===t[n])throw Error("Object "+t+' has no property "'+n+'"');o.color?t=new c(t,n):(t=[t,n].concat(o.factoryArgs),t=i.apply(e,t));o.before instanceof r&&(o.before=o.before.__li);y(e,t);f.addClass(t.domElement,"c");n=document.createElement("span");f.addClass(n,"property-name");n.innerHTML=t.property;var s=document.createElement("div");s.appendChild(n);s.appendChild(t.domElement);o=g(e,s,o.before);f.addClass(o,M.CLASS_CONTROLLER_ROW);f.addClass(o,typeof t.getValue());_(e,o,t);e.__controllers.push(t);return t}function g(e,t,n){var i=document.createElement("li");t&&i.appendChild(t);n?e.__ul.insertBefore(i,params.before):e.__ul.appendChild(i);e.onResize();return i}function _(e,t,n){n.__li=t;n.__gui=e;m.extend(n,{options:function(t){if(1<arguments.length)return n.remove(),p(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[m.toArray(arguments)]});if(m.isArray(t)||m.isObject(t))return n.remove(),p(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[t]})},name:function(e){n.__li.firstElementChild.firstElementChild.innerHTML=e;return n},listen:function(){n.__gui.listen(n);return n},remove:function(){n.__gui.remove(n);return n}});if(n instanceof d){var i=new a(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});m.each(["updateDisplay","onChange","onFinishChange"],function(e){var t=n[e],r=i[e];n[e]=i[e]=function(){var e=Array.prototype.slice.call(arguments);t.apply(n,e);return r.apply(i,e)}});f.addClass(t,"has-slider");n.domElement.insertBefore(i.domElement,n.domElement.firstElementChild)}else if(n instanceof a){var r=function(t){return m.isNumber(n.__min)&&m.isNumber(n.__max)?(n.remove(),p(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]})):t};n.min=m.compose(r,n.min);n.max=m.compose(r,n.max)}else n instanceof o?(f.bind(t,"click",function(){f.fakeEvent(n.__checkbox,"click")}),f.bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof s?(f.bind(t,"click",function(){f.fakeEvent(n.__button,"click")}),f.bind(t,"mouseover",function(){f.addClass(n.__button,"hover")}),f.bind(t,"mouseout",function(){f.removeClass(n.__button,"hover")})):n instanceof c&&(f.addClass(t,"color"),n.updateDisplay=m.compose(function(e){t.style.borderLeftColor=n.__color.toString();return e},n.updateDisplay),n.updateDisplay());n.setValue=m.compose(function(t){e.getRoot().__preset_select&&n.isModified()&&C(e.getRoot(),!0);return t},n.setValue)}function y(e,t){var n=e.getRoot(),i=n.__rememberedObjects.indexOf(t.object);if(-1!=i){var r=n.__rememberedObjectIndecesToControllers[i];void 0===r&&(r={},n.__rememberedObjectIndecesToControllers[i]=r);r[t.property]=t;if(n.load&&n.load.remembered){n=n.load.remembered;if(n[e.preset])n=n[e.preset];else if(n[F])n=n[F];else return;n[i]&&void 0!==n[i][t.property]&&(i=n[i][t.property],t.initialValue=i,t.setValue(i))}}}function b(e){var t=e.__save_row=document.createElement("li");f.addClass(e.domElement,"has-save");e.__ul.insertBefore(t,e.__ul.firstChild);f.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;";f.addClass(n,"button gears");var i=document.createElement("span");i.innerHTML="Save";f.addClass(i,"button");f.addClass(i,"save");var r=document.createElement("span");r.innerHTML="New";f.addClass(r,"button");f.addClass(r,"save-as");var o=document.createElement("span");o.innerHTML="Revert";f.addClass(o,"button");f.addClass(o,"revert");var s=e.__preset_select=document.createElement("select");e.load&&e.load.remembered?m.each(e.load.remembered,function(t,n){E(e,n,n==e.preset)}):E(e,F,!1);f.bind(s,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value});t.appendChild(s);t.appendChild(n);t.appendChild(i);t.appendChild(r);t.appendChild(o);if(k){var t=document.getElementById("dg-save-locally"),a=document.getElementById("dg-local-explain");t.style.display="block";t=document.getElementById("dg-local-storage");"true"===localStorage.getItem(document.location.href+".isLocal")&&t.setAttribute("checked","checked");var d=function(){a.style.display=e.useLocalStorage?"block":"none"};d();f.bind(t,"change",function(){e.useLocalStorage=!e.useLocalStorage;d()})}var l=document.getElementById("dg-new-constructor");f.bind(l,"keydown",function(e){!e.metaKey||67!==e.which&&67!=e.keyCode||R.hide()});f.bind(n,"click",function(){l.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2);R.show();l.focus();l.select()});f.bind(i,"click",function(){e.save()});f.bind(r,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)});f.bind(o,"click",function(){e.revert()})}function v(e){function t(t){t.preventDefault();r=t.clientX;f.addClass(e.__closeButton,M.CLASS_DRAG);f.bind(window,"mousemove",n);f.bind(window,"mouseup",i);return!1}function n(t){t.preventDefault();e.width+=r-t.clientX;e.onResize();r=t.clientX;return!1}function i(){f.removeClass(e.__closeButton,M.CLASS_DRAG);f.unbind(window,"mousemove",n);f.unbind(window,"mouseup",i)}e.__resize_handle=document.createElement("div");m.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var r;f.bind(e.__resize_handle,"mousedown",t);f.bind(e.__closeButton,"mousedown",t);e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function x(e,t){e.domElement.style.width=t+"px";e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px");e.__closeButton&&(e.__closeButton.style.width=t+"px")}function w(e,t){var n={};m.each(e.__rememberedObjects,function(i,r){var o={};m.each(e.__rememberedObjectIndecesToControllers[r],function(e,n){o[n]=t?e.initialValue:e.getValue()});n[r]=o});return n}function E(e,t,n){var i=document.createElement("option");i.innerHTML=t;i.value=t;e.__preset_select.appendChild(i);n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function C(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function A(e){0!=e.length&&u(function(){A(e)});m.each(e,function(e){e.updateDisplay()})}e.inject(n);var F="Default",k;try{k="localStorage"in window&&null!==window.localStorage}catch(e){k=!1}var R,S=!0,D,G=!1,T=[],M=function(e){function t(){localStorage.setItem(document.location.href+".gui",JSON.stringify(i.getSaveObject()))}function n(){var e=i.getRoot();e.width+=1;m.defer(function(){e.width-=1})}var i=this;this.domElement=document.createElement("div");this.__ul=document.createElement("ul");this.domElement.appendChild(this.__ul);f.addClass(this.domElement,"dg");this.__folders={};this.__controllers=[];this.__rememberedObjects=[];this.__rememberedObjectIndecesToControllers=[];this.__listening=[];e=e||{};e=m.defaults(e,{autoPlace:!0,width:M.DEFAULT_WIDTH});e=m.defaults(e,{resizable:e.autoPlace,hideable:e.autoPlace});m.isUndefined(e.load)?e.load={preset:F}:e.preset&&(e.load.preset=e.preset);m.isUndefined(e.parent)&&e.hideable&&T.push(this);e.resizable=m.isUndefined(e.parent)&&e.resizable;e.autoPlace&&m.isUndefined(e.scrollable)&&(e.scrollable=!0);var r=k&&"true"===localStorage.getItem(document.location.href+".isLocal");Object.defineProperties(this,{parent:{get:function(){return e.parent}},scrollable:{get:function(){return e.scrollable}},autoPlace:{get:function(){return e.autoPlace}},preset:{get:function(){return i.parent?i.getRoot().preset:e.load.preset},set:function(t){i.parent?i.getRoot().preset=t:e.load.preset=t;for(t=0;t<this.__preset_select.length;t++)this.__preset_select[t].value==this.preset&&(this.__preset_select.selectedIndex=t);i.revert()}},width:{get:function(){return e.width},set:function(t){e.width=t;x(i,t)}},name:{get:function(){return e.name},set:function(t){e.name=t;s&&(s.innerHTML=e.name)}},closed:{get:function(){return e.closed},set:function(t){e.closed=t;e.closed?f.addClass(i.__ul,M.CLASS_CLOSED):f.removeClass(i.__ul,M.CLASS_CLOSED);this.onResize();i.__closeButton&&(i.__closeButton.innerHTML=t?M.TEXT_OPEN:M.TEXT_CLOSED)}},load:{get:function(){return e.load}},useLocalStorage:{get:function(){return r},set:function(e){k&&((r=e)?f.bind(window,"unload",t):f.unbind(window,"unload",t),localStorage.setItem(document.location.href+".isLocal",e))}}});if(m.isUndefined(e.parent)){e.closed=!1;f.addClass(this.domElement,M.CLASS_MAIN);f.makeSelectable(this.domElement,!1);if(k&&r){i.useLocalStorage=!0;var o=localStorage.getItem(document.location.href+".gui");o&&(e.load=JSON.parse(o))}this.__closeButton=document.createElement("div");this.__closeButton.innerHTML=M.TEXT_CLOSED;f.addClass(this.__closeButton,M.CLASS_CLOSE_BUTTON);this.domElement.appendChild(this.__closeButton);f.bind(this.__closeButton,"click",function(){i.closed=!i.closed})}else{void 0===e.closed&&(e.closed=!0);var s=document.createTextNode(e.name);f.addClass(s,"controller-name");o=g(i,s);f.addClass(this.__ul,M.CLASS_CLOSED);f.addClass(o,"title");f.bind(o,"click",function(e){e.preventDefault();i.closed=!i.closed;return!1});e.closed||(this.closed=!1)}e.autoPlace&&(m.isUndefined(e.parent)&&(S&&(D=document.createElement("div"),f.addClass(D,"dg"),f.addClass(D,M.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(D),S=!1),D.appendChild(this.domElement),f.addClass(this.domElement,M.CLASS_AUTO_PLACE)),this.parent||x(i,e.width));f.bind(window,"resize",function(){i.onResize()});f.bind(this.__ul,"webkitTransitionEnd",function(){i.onResize()});f.bind(this.__ul,"transitionend",function(){i.onResize()});f.bind(this.__ul,"oTransitionEnd",function(){i.onResize()});this.onResize();e.resizable&&v(this);i.getRoot();e.parent||n()};M.toggleHide=function(){G=!G;m.each(T,function(e){e.domElement.style.zIndex=G?-999:999;e.domElement.style.opacity=G?0:1})};M.CLASS_AUTO_PLACE="a";M.CLASS_AUTO_PLACE_CONTAINER="ac";M.CLASS_MAIN="main";M.CLASS_CONTROLLER_ROW="cr";M.CLASS_TOO_TALL="taller-than-window";M.CLASS_CLOSED="closed";M.CLASS_CLOSE_BUTTON="close-button";M.CLASS_DRAG="drag";M.DEFAULT_WIDTH=245;M.TEXT_CLOSED="Close Controls";M.TEXT_OPEN="Open Controls";f.bind(window,"keydown",function(e){"text"===document.activeElement.type||72!==e.which&&72!=e.keyCode||M.toggleHide()},!1);m.extend(M.prototype,{add:function(e,t){return p(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return p(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li);this.__controllers.slice(this.__controllers.indexOf(e),1);var t=this;m.defer(function(){t.onResize()})},destroy:function(){this.autoPlace&&D.removeChild(this.domElement)},addFolder:function(e){if(void 0!==this.__folders[e])throw Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace;this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);t=new M(t);this.__folders[e]=t;e=g(this,t.domElement);f.addClass(e,"folder");return t},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=f.getOffset(e.__ul).top,n=0;m.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=f.getHeight(t))});window.innerHeight-t-20<n?(f.addClass(e.domElement,M.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(f.removeClass(e.domElement,M.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&m.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"});e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},remember:function(){m.isUndefined(R)&&(R=new h,R.domElement.innerHTML=t);if(this.parent)throw Error("You can only call remember on a top level GUI.");var e=this;m.each(Array.prototype.slice.call(arguments),function(t){0==e.__rememberedObjects.length&&b(e);-1==e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)});this.autoPlace&&x(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;e.closed=this.closed;0<this.__rememberedObjects.length&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=w(this));e.folders={};m.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()});return e},save:function(){this.load.remembered||(this.load.remembered={});this.load.remembered[this.preset]=w(this);C(this,!1)},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[F]=w(this,!0));this.load.remembered[e]=w(this);this.preset=e;E(this,e,!0)},revert:function(e){m.each(this.__controllers,function(t){this.getRoot().load.remembered?y(e||this.getRoot(),t):t.setValue(t.initialValue)},this);m.each(this.__folders,function(e){e.revert(e)});e||C(this.getRoot(),!1)},listen:function(e){var t=0==this.__listening.length;this.__listening.push(e);t&&A(this.__listening)}});return M}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',".dg {\n  /** Clear list styles */\n  /* Auto-place container */\n  /* Auto-placed GUI's */\n  /* Line items that don't contain folders. */\n  /** Folder names */\n  /** Hides closed items */\n  /** Controller row */\n  /** Name-half (left) */\n  /** Controller-half (right) */\n  /** Controller placement */\n  /** Shorter number boxes when slider is present. */\n  /** Ensure the entire boolean and function row shows a hand */ }\n  .dg ul {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n    width: 100%;\n    clear: both; }\n  .dg.ac {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 0;\n    z-index: 0; }\n  .dg:not(.ac) .main {\n    /** Exclude mains in ac so that we don't hide close button */\n    overflow: hidden; }\n  .dg.main {\n    -webkit-transition: opacity 0.1s linear;\n    -o-transition: opacity 0.1s linear;\n    -moz-transition: opacity 0.1s linear;\n    transition: opacity 0.1s linear; }\n    .dg.main.taller-than-window {\n      overflow-y: auto; }\n      .dg.main.taller-than-window .close-button {\n        opacity: 1;\n        /* TODO, these are style notes */\n        margin-top: -1px;\n        border-top: 1px solid #2c2c2c; }\n    .dg.main ul.closed .close-button {\n      opacity: 1 !important; }\n    .dg.main:hover .close-button,\n    .dg.main .close-button.drag {\n      opacity: 1; }\n    .dg.main .close-button {\n      /*opacity: 0;*/\n      -webkit-transition: opacity 0.1s linear;\n      -o-transition: opacity 0.1s linear;\n      -moz-transition: opacity 0.1s linear;\n      transition: opacity 0.1s linear;\n      border: 0;\n      position: absolute;\n      line-height: 19px;\n      height: 20px;\n      /* TODO, these are style notes */\n      cursor: pointer;\n      text-align: center;\n      background-color: #000; }\n      .dg.main .close-button:hover {\n        background-color: #111; }\n  .dg.a {\n    float: right;\n    margin-right: 15px;\n    overflow-x: hidden; }\n    .dg.a.has-save > ul {\n      margin-top: 27px; }\n      .dg.a.has-save > ul.closed {\n        margin-top: 0; }\n    .dg.a .save-row {\n      position: fixed;\n      top: 0;\n      z-index: 1002; }\n  .dg li {\n    -webkit-transition: height 0.1s ease-out;\n    -o-transition: height 0.1s ease-out;\n    -moz-transition: height 0.1s ease-out;\n    transition: height 0.1s ease-out; }\n  .dg li:not(.folder) {\n    cursor: auto;\n    height: 27px;\n    line-height: 27px;\n    overflow: hidden;\n    padding: 0 4px 0 5px; }\n  .dg li.folder {\n    padding: 0;\n    border-left: 4px solid rgba(0, 0, 0, 0); }\n  .dg li.title {\n    cursor: pointer;\n    margin-left: -4px; }\n  .dg .closed li:not(.title),\n  .dg .closed ul li,\n  .dg .closed ul li > * {\n    height: 0;\n    overflow: hidden;\n    border: 0; }\n  .dg .cr {\n    clear: both;\n    padding-left: 3px;\n    height: 27px; }\n  .dg .property-name {\n    cursor: default;\n    float: left;\n    clear: left;\n    width: 40%;\n    overflow: hidden;\n    text-overflow: ellipsis; }\n  .dg .c {\n    float: left;\n    width: 60%; }\n  .dg .c input[type=text] {\n    border: 0;\n    margin-top: 4px;\n    padding: 3px;\n    width: 100%;\n    float: right; }\n  .dg .has-slider input[type=text] {\n    width: 30%;\n    /*display: none;*/\n    margin-left: 0; }\n  .dg .slider {\n    float: left;\n    width: 66%;\n    margin-left: -5px;\n    margin-right: 0;\n    height: 19px;\n    margin-top: 4px; }\n  .dg .slider-fg {\n    height: 100%; }\n  .dg .c input[type=checkbox] {\n    margin-top: 9px; }\n  .dg .c select {\n    margin-top: 5px; }\n  .dg .cr.function,\n  .dg .cr.function .property-name,\n  .dg .cr.function *,\n  .dg .cr.boolean,\n  .dg .cr.boolean * {\n    cursor: pointer; }\n  .dg .selector {\n    display: none;\n    position: absolute;\n    margin-left: -9px;\n    margin-top: 23px;\n    z-index: 10; }\n  .dg .c:hover .selector,\n  .dg .selector.drag {\n    display: block; }\n  .dg li.save-row {\n    padding: 0; }\n    .dg li.save-row .button {\n      display: inline-block;\n      padding: 0px 6px; }\n  .dg.dialogue {\n    background-color: #222;\n    width: 460px;\n    padding: 15px;\n    font-size: 13px;\n    line-height: 15px; }\n\n/* TODO Separate style and structure */\n#dg-new-constructor {\n  padding: 10px;\n  color: #222;\n  font-family: Monaco, monospace;\n  font-size: 10px;\n  border: 0;\n  resize: none;\n  box-shadow: inset 1px 1px 1px #888;\n  word-wrap: break-word;\n  margin: 12px 0;\n  display: block;\n  width: 440px;\n  overflow-y: scroll;\n  height: 100px;\n  position: relative; }\n\n#dg-local-explain {\n  display: none;\n  font-size: 11px;\n  line-height: 17px;\n  border-radius: 3px;\n  background-color: #333;\n  padding: 8px;\n  margin-top: 10px; }\n  #dg-local-explain code {\n    font-size: 10px; }\n\n#dat-gui-save-locally {\n  display: none; }\n\n/** Main type */\n.dg {\n  color: #eee;\n  font: 11px 'Lucida Grande', sans-serif;\n  text-shadow: 0 -1px 0 #111;\n  /** Auto place */\n  /* Controller row, <li> */\n  /** Controllers */ }\n  .dg.main {\n    /** Scrollbar */ }\n    .dg.main::-webkit-scrollbar {\n      width: 5px;\n      background: #1a1a1a; }\n    .dg.main::-webkit-scrollbar-corner {\n      height: 0;\n      display: none; }\n    .dg.main::-webkit-scrollbar-thumb {\n      border-radius: 5px;\n      background: #676767; }\n  .dg li:not(.folder) {\n    background: #1a1a1a;\n    border-bottom: 1px solid #2c2c2c; }\n  .dg li.save-row {\n    line-height: 25px;\n    background: #dad5cb;\n    border: 0; }\n    .dg li.save-row select {\n      margin-left: 5px;\n      width: 108px; }\n    .dg li.save-row .button {\n      margin-left: 5px;\n      margin-top: 1px;\n      border-radius: 2px;\n      font-size: 9px;\n      line-height: 7px;\n      padding: 4px 4px 5px 4px;\n      background: #c5bdad;\n      color: #fff;\n      text-shadow: 0 1px 0 #b0a58f;\n      box-shadow: 0 -1px 0 #b0a58f;\n      cursor: pointer; }\n      .dg li.save-row .button.gears {\n        background: #c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;\n        height: 7px;\n        width: 8px; }\n      .dg li.save-row .button:hover {\n        background-color: #bab19e;\n        box-shadow: 0 -1px 0 #b0a58f; }\n  .dg li.folder {\n    border-bottom: 0; }\n  .dg li.title {\n    padding-left: 16px;\n    background: black url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;\n    cursor: pointer;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.2); }\n  .dg .closed li.title {\n    background-image: url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==); }\n  .dg .cr.boolean {\n    border-left: 3px solid #806787; }\n  .dg .cr.function {\n    border-left: 3px solid #e61d5f; }\n  .dg .cr.number {\n    border-left: 3px solid #2fa1d6; }\n    .dg .cr.number input[type=text] {\n      color: #2fa1d6; }\n  .dg .cr.string {\n    border-left: 3px solid #1ed36f; }\n    .dg .cr.string input[type=text] {\n      color: #1ed36f; }\n  .dg .cr.function:hover, .dg .cr.boolean:hover {\n    background: #111; }\n  .dg .c input[type=text] {\n    background: #303030;\n    outline: none; }\n    .dg .c input[type=text]:hover {\n      background: #3c3c3c; }\n    .dg .c input[type=text]:focus {\n      background: #494949;\n      color: #fff; }\n  .dg .c .slider {\n    background: #303030;\n    cursor: ew-resize; }\n  .dg .c .slider-fg {\n    background: #2fa1d6; }\n  .dg .c .slider:hover {\n    background: #3c3c3c; }\n    .dg .c .slider:hover .slider-fg {\n      background: #44abda; }\n",dat.controllers.factory=function(e,t,n,i,r,o,s){return function(a,d,l,c){var u=a[d];
if(s.isArray(l)||s.isObject(l))return new e(a,d,l);if(s.isNumber(u))return s.isNumber(l)&&s.isNumber(c)?new n(a,d,l,c):new t(a,d,{min:l,max:c});if(s.isString(u))return new i(a,d);if(s.isFunction(u))return new r(a,d,"");if(s.isBoolean(u))return new o(a,d)}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(e,t,n){var i=function(e,n){function r(){o.setValue(o.__input.value)}i.superclass.call(this,e,n);var o=this;this.__input=document.createElement("input");this.__input.setAttribute("type","text");t.bind(this.__input,"keyup",r);t.bind(this.__input,"change",r);t.bind(this.__input,"blur",function(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())});t.bind(this.__input,"keydown",function(e){13===e.keyCode&&this.blur()});this.updateDisplay();this.domElement.appendChild(this.__input)};i.superclass=e;n.extend(i.prototype,e.prototype,{updateDisplay:function(){t.isActive(this.__input)||(this.__input.value=this.getValue());return i.superclass.prototype.updateDisplay.call(this)}});return i}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,dat.controllers.ColorController=function(e,t,n,i,r){function o(e,t,n,i){e.style.background="";r.each(d,function(r){e.style.cssText+="background: "+r+"linear-gradient("+t+", "+n+" 0%, "+i+" 100%); "})}function s(e){e.style.background="";e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var a=function(e,d){function l(e){f(e);t.bind(window,"mousemove",f);t.bind(window,"mouseup",c)}function c(){t.unbind(window,"mousemove",f);t.unbind(window,"mouseup",c)}function u(){var e=i(this.value);!1!==e?(p.__color.__state=e,p.setValue(p.__color.toOriginal())):this.value=p.__color.toString()}function h(){t.unbind(window,"mousemove",m);t.unbind(window,"mouseup",h)}function f(e){e.preventDefault();var n=t.getWidth(p.__saturation_field),i=t.getOffset(p.__saturation_field),r=(e.clientX-i.left+document.body.scrollLeft)/n;e=1-(e.clientY-i.top+document.body.scrollTop)/n;1<e?e=1:0>e&&(e=0);1<r?r=1:0>r&&(r=0);p.__color.v=e;p.__color.s=r;p.setValue(p.__color.toOriginal());return!1}function m(e){e.preventDefault();var n=t.getHeight(p.__hue_field),i=t.getOffset(p.__hue_field);e=1-(e.clientY-i.top+document.body.scrollTop)/n;1<e?e=1:0>e&&(e=0);p.__color.h=360*e;p.setValue(p.__color.toOriginal());return!1}a.superclass.call(this,e,d);this.__color=new n(this.getValue());this.__temp=new n(0);var p=this;this.domElement=document.createElement("div");t.makeSelectable(this.domElement,!1);this.__selector=document.createElement("div");this.__selector.className="selector";this.__saturation_field=document.createElement("div");this.__saturation_field.className="saturation-field";this.__field_knob=document.createElement("div");this.__field_knob.className="field-knob";this.__field_knob_border="2px solid ";this.__hue_knob=document.createElement("div");this.__hue_knob.className="hue-knob";this.__hue_field=document.createElement("div");this.__hue_field.className="hue-field";this.__input=document.createElement("input");this.__input.type="text";this.__input_textShadow="0 1px 1px ";t.bind(this.__input,"keydown",function(e){13===e.keyCode&&u.call(this)});t.bind(this.__input,"blur",u);t.bind(this.__selector,"mousedown",function(e){t.addClass(this,"drag").bind(window,"mouseup",function(e){t.removeClass(p.__selector,"drag")})});var g=document.createElement("div");r.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"});r.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(.5>this.__color.v?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1});r.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1});r.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"});r.extend(g.style,{width:"100%",height:"100%",background:"none"});o(g,"top","rgba(0,0,0,0)","#000");r.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"});s(this.__hue_field);r.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"});t.bind(this.__saturation_field,"mousedown",l);t.bind(this.__field_knob,"mousedown",l);t.bind(this.__hue_field,"mousedown",function(e){m(e);t.bind(window,"mousemove",m);t.bind(window,"mouseup",h)});this.__saturation_field.appendChild(g);this.__selector.appendChild(this.__field_knob);this.__selector.appendChild(this.__saturation_field);this.__selector.appendChild(this.__hue_field);this.__hue_field.appendChild(this.__hue_knob);this.domElement.appendChild(this.__input);this.domElement.appendChild(this.__selector);this.updateDisplay()};a.superclass=e;r.extend(a.prototype,e.prototype,{updateDisplay:function(){var e=i(this.getValue());if(!1!==e){var t=!1;r.each(n.COMPONENTS,function(n){if(!r.isUndefined(e[n])&&!r.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}},this);t&&r.extend(this.__color.__state,e)}r.extend(this.__temp.__state,this.__color.__state);this.__temp.a=1;var s=.5>this.__color.v||.5<this.__color.s?255:0,a=255-s;r.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+s+","+s+","+s+")"});this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px";this.__temp.s=1;this.__temp.v=1;o(this.__saturation_field,"left","#fff",this.__temp.toString());r.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+s+","+s+","+s+")",textShadow:this.__input_textShadow+"rgba("+a+","+a+","+a+",.7)"})}});var d=["-moz-","-o-","-webkit-","-ms-",""];return a}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(e,t,n,i){function r(e,t,n){Object.defineProperty(e,t,{get:function(){if("RGB"===this.__state.space)return this.__state[t];s(this,t,n);return this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(s(this,t,n),this.__state.space="RGB");this.__state[t]=e}})}function o(e,t){Object.defineProperty(e,t,{get:function(){if("HSV"===this.__state.space)return this.__state[t];a(this);return this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(a(this),this.__state.space="HSV");this.__state[t]=e}})}function s(e,n,r){if("HEX"===e.__state.space)e.__state[n]=t.component_from_hex(e.__state.hex,r);else if("HSV"===e.__state.space)i.extend(e.__state,t.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v));else throw"Corrupted color state"}function a(e){var n=t.rgb_to_hsv(e.r,e.g,e.b);i.extend(e.__state,{s:n.s,v:n.v});i.isNaN(n.h)?i.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=n.h}var d=function(){this.__state=e.apply(this,arguments);if(!1===this.__state)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};d.COMPONENTS="r g b h s v hex a".split(" ");i.extend(d.prototype,{toString:function(){return n(this)},toOriginal:function(){return this.__state.conversion.write(this)}});r(d.prototype,"r",2);r(d.prototype,"g",1);r(d.prototype,"b",0);o(d.prototype,"h");o(d.prototype,"s");o(d.prototype,"v");Object.defineProperty(d.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}});Object.defineProperty(d.prototype,"hex",{get:function(){"HEX"!==!this.__state.space&&(this.__state.hex=t.rgb_to_hex(this.r,this.g,this.b));return this.__state.hex},set:function(e){this.__state.space="HEX";this.__state.hex=e}});return d}(dat.color.interpret,dat.color.math=function(){var e;return{hsv_to_rgb:function(e,t,n){var i=e/60-Math.floor(e/60),r=n*(1-t),o=n*(1-i*t);t=n*(1-(1-i)*t);e=[[n,t,r],[o,n,r],[r,n,t],[r,o,n],[t,r,n],[n,r,o]][Math.floor(e/60)%6];return{r:255*e[0],g:255*e[1],b:255*e[2]}},rgb_to_hsv:function(e,t,n){var i=Math.min(e,t,n),r=Math.max(e,t,n),i=r-i;if(0==r)return{h:NaN,s:0,v:0};e=(e==r?(t-n)/i:t==r?2+(n-e)/i:4+(e-t)/i)/6;0>e&&(e+=1);return{h:360*e,s:i/r,v:r/255}},rgb_to_hex:function(e,t,n){e=this.hex_with_component(0,2,e);e=this.hex_with_component(e,1,t);return e=this.hex_with_component(e,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(t,n,i){return i<<(e=8*n)|t&~(255<<e)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}(),dat.dom.CenteredDiv=function(e,t){var n=function(){this.backgroundElement=document.createElement("div");t.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"});e.makeFullscreen(this.backgroundElement);this.backgroundElement.style.position="fixed";this.domElement=document.createElement("div");t.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"});document.body.appendChild(this.backgroundElement);document.body.appendChild(this.domElement);var n=this;e.bind(this.backgroundElement,"click",function(){n.hide()})};n.prototype.show=function(){var e=this;this.backgroundElement.style.display="block";this.domElement.style.display="block";this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)";this.layout();t.defer(function(){e.backgroundElement.style.opacity=1;e.domElement.style.opacity=1;e.domElement.style.webkitTransform="scale(1)"})};n.prototype.hide=function(){var t=this,n=function(){t.domElement.style.display="none";t.backgroundElement.style.display="none";e.unbind(t.domElement,"webkitTransitionEnd",n);e.unbind(t.domElement,"transitionend",n);e.unbind(t.domElement,"oTransitionEnd",n)};e.bind(this.domElement,"webkitTransitionEnd",n);e.bind(this.domElement,"transitionend",n);e.bind(this.domElement,"oTransitionEnd",n);this.backgroundElement.style.opacity=0;this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)"};n.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-e.getWidth(this.domElement)/2+"px";this.domElement.style.top=window.innerHeight/2-e.getHeight(this.domElement)/2+"px"};return n}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common);var Jenjens={color:{toRGBarray:function(e){throw"Error: Jenjens.color.toRGBarray() has not been written yet"},toHex:function(e){if(e[0]!=null)return Jenjens.color.rgbComponentsToHex({r:e[0],g:e[1],b:e[2]});if(e.r!=null)return Jenjens.color.rgbComponentsToHex(e);if(e.substr(0,3)=="rgb")return Jenjens.color.rgbStringToHex(e);if(e.charAt(0)=="#"){if(e.length<7)return Jenjens.color.shortHexToHex(e);return e}return Jenjens.color.nameToHex(e)},rgbComponentsToHex:function(e){return"#"+Jenjens.string.pad(e.r.toString(16),2)+Jenjens.string.pad(e.g.toString(16),2)+Jenjens.string.pad(e.b.toString(16),2)},rgbStringToHex:function(e){throw"Error: Jenjens.color.rgbStringToHex() is broken"},shortHexToHex:function(e){return"#"+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2)+e.charAt(3)+e.charAt(3)},nameToHex:function(e){switch(e.toLowerCase()){case"aliceblue":return"#F0F8FF";case"antiquewhite":return"#FAEBD7";case"aqua":return"#00FFFF";case"aquamarine":return"#7FFFD4";case"azure":return"#F0FFFF";case"beige":return"#F5F5DC";case"bisque":return"#FFE4C4";case"black":return"#000000";case"blanchedalmond":return"#FFEBCD";case"blue":return"#0000FF";case"blueviolet":return"#8A2BE2";case"brown":return"#A52A2A";case"burlywood":return"#DEB887";case"cadetblue":return"#5F9EA0";case"chartreuse":return"#7FFF00";case"chocolate":return"#D2691E";case"coral":return"#FF7F50";case"cornflowerblue":return"#6495ED";case"cornsilk":return"#FFF8DC";case"crimson":return"#DC143C";case"cyan":return"#00FFFF";case"darkblue":return"#00008B";case"darkcyan":return"#008B8B";case"darkgoldenrod":return"#B8860B";case"darkgrey":case"darkgray":return"#A9A9A9";case"darkgreen":return"#006400";case"darkkhaki":return"#BDB76B";case"darkmagenta":return"#8B008B";case"darkolivegreen":return"#556B2F";case"darkorange":return"#FF8C00";case"darkorchid":return"#9932CC";case"darkred":return"#8B0000";case"darksalmon":return"#E9967A";case"darkseagreen":return"#8FBC8F";case"darkslateblue":return"#483D8B";case"darkslategrey":case"darkslategray":return"#2F4F4F";case"darkturquoise":return"#00CED1";case"darkviolet":return"#9400D3";case"deeppink":return"#FF1493";case"deepskyblue":return"#00BFFF";case"dimgrey":case"dimgray":return"#696969";case"dodgerblue":return"#1E90FF";case"firebrick":return"#B22222";case"floralwhite":return"#FFFAF0";case"forestgreen":return"#228B22";case"fuchsia":return"#FF00FF";case"gainsboro":return"#DCDCDC";case"ghostwhite":return"#F8F8FF";case"gold":return"#FFD700";case"goldenrod":return"#DAA520";case"grey":case"gray":return"#808080";case"green":return"#008000";case"greenyellow":return"#ADFF2F";case"honeydew":return"#F0FFF0";case"hotpink":return"#FF69B4";case"indianred":return"#CD5C5C";case"indigo":return"#4B0082";case"ivory":return"#FFFFF0";case"khaki":return"#F0E68C";case"lavender":return"#E6E6FA";case"lavenderblush":return"#FFF0F5";case"lawngreen":return"#7CFC00";case"lemonchiffon":return"#FFFACD";case"lightblue":return"#ADD8E6";case"lightcoral":return"#F08080";case"lightcyan":return"#E0FFFF";case"lightgoldenrodyellow":return"#FAFAD2";case"lightgrey":case"lightgray":return"#D3D3D3";case"lightgreen":return"#90EE90";case"lightpink":return"#FFB6C1";case"lightsalmon":return"#FFA07A";case"lightseagreen":return"#20B2AA";case"lightskyblue":return"#87CEFA";case"lightslategrey":case"lightslategray":return"#778899";case"lightsteelblue":return"#B0C4DE";case"lightyellow":return"#FFFFE0";case"lime":return"#00FF00";case"limegreen":return"#32CD32";case"linen":return"#FAF0E6";case"magenta":return"#FF00FF";case"maroon":return"#800000";case"mediumaquamarine":return"#66CDAA";case"mediumblue":return"#0000CD";case"mediumorchid":return"#BA55D3";case"mediumpurple":return"#9370DB";case"mediumseagreen":return"#3CB371";case"mediumslateblue":return"#7B68EE";case"mediumspringgreen":return"#00FA9A";case"mediumturquoise":return"#48D1CC";case"mediumvioletred":return"#C71585";case"midnightblue":return"#191970";case"mintcream":return"#F5FFFA";case"mistyrose":return"#FFE4E1";case"moccasin":return"#FFE4B5";case"navajowhite":return"#FFDEAD";case"navy":return"#000080";case"oldlace":return"#FDF5E6";case"olive":return"#808000";case"olivedrab":return"#6B8E23";case"orange":return"#FFA500";case"orangered":return"#FF4500";case"orchid":return"#DA70D6";case"palegoldenrod":return"#EEE8AA";case"palegreen":return"#98FB98";case"paleturquoise":return"#AFEEEE";case"palevioletred":return"#DB7093";case"papayawhip":return"#FFEFD5";case"peachpuff":return"#FFDAB9";case"peru":return"#CD853F";case"pink":return"#FFC0CB";case"plum":return"#DDA0DD";case"powderblue":return"#B0E0E6";case"purple":return"#800080";case"red":return"#FF0000";case"rosybrown":return"#BC8F8F";case"royalblue":return"#4169E1";case"saddlebrown":return"#8B4513";case"salmon":return"#FA8072";case"sandybrown":return"#F4A460";case"seagreen":return"#2E8B57";case"seashell":return"#FFF5EE";case"sienna":return"#A0522D";case"silver":return"#C0C0C0";case"skyblue":return"#87CEEB";case"slateblue":return"#6A5ACD";case"slategrey":case"slategray":return"#708090";case"snow":return"#FFFAFA";case"springgreen":return"#00FF7F";case"steelblue":return"#4682B4";case"tan":return"#D2B48C";case"teal":return"#008080";case"thistle":return"#D8BFD8";case"tomato":return"#FF6347";case"turquoise":return"#40E0D0";case"violet":return"#EE82EE";case"wheat":return"#F5DEB3";case"white":return"#FFFFFF";case"whitesmoke":return"#F5F5F5";case"yellow":return"#FFFF00";case"yellowgreen":return"#9ACD32";default:console.log("Error: Invalid color name: "+e);return"#FFFFFF"}},toRGBcomponents:function(e){throw"Error: Jenjens.color.toRGBcomponents() has not been made"},hexToRGBcomponents:function(e){return{r:parseInt("0x"+e.substr(1,2)),g:parseInt("0x"+e.substr(3,2)),b:parseInt("0x"+e.substr(5,2))}},hexToRGBAcomponents:function(e,t){return{r:parseInt("0x"+e.substr(1,2)),g:parseInt("0x"+e.substr(3,2)),b:parseInt("0x"+e.substr(5,2)),a:t}},parseRGBcomponents:function(e){return"rgb("+e.r+","+e.g+","+e.b+")"},parseRGBAcomponents:function(e){return"rgba("+e.r+","+e.g+","+e.b+","+e.a+")"},parseRGB:function(e,t,n){return"rgb("+e+","+t+","+n+")"},parseRGBA:function(e,t,n,i){return"rgba("+e+","+t+","+n+","+i+")"}},Math:{Tau:Math.PI*2,getDistance:function(e,t){var n=e.x-t.x;var i=e.y-t.y;return Math.sqrt(n*n+i*i)},toDegrees:function(e){return e*180/Math.PI},toRadians:function(e){return e*Math.PI/180},Vector:function(e,t,n){if(n){!e?this.magnitude=0:this.magnitude=e;!t?this.direction=0:this.direction=t}else{!e?this.Vx=0:this.Vx=e;!t?this.Vy=0:this.Vy=t}if(e!=undefined){if(e.x!=undefined){this.Vx=e.x;this.Vy=e.y}if(e.Vx!=undefined){this.Vx=e.Vx;this.Vy=e.Vy}if(e.magnitude!=undefined){this.magnitude=e.magnitude;this.direction=e.direction}}this.toPolar=function(){this.magnitude=Math.sqrt(this.Vx*this.Vx+this.Vy*this.Vy);this.direction=Math.atan2(this.Vy,this.Vx);delete this.Vx;delete this.Vy};this.toCartesian=function(){this.Vx=Math.cos(this.direction)*this.magnitude;this.Vy=Math.sin(this.direction)*this.magnitude;delete this.magnitude;delete this.direction};this.add=function(e){if(this.Vx!=undefined){if(e.Vx!=undefined){this.Vx+=e.Vx;this.Vy+=e.Vy}else{this.Vx+=Math.cos(e.direction)*e.magnitude;this.Vy+=Math.sin(e.direction)*e.magnitude}}else{if(e.Vx!=undefined){this.Vx=Math.cos(this.direction)*this.magnitude+e.Vx;this.Vy=Math.sin(this.direction)*this.magnitude+e.Vy;this.toPolar()}else{this.Vx=Math.cos(this.direction)*this.magnitude+Math.cos(e.direction)*e.magnitude;this.Vy=Math.sin(this.direction)*this.magnitude+Math.sin(e.direction)*e.magnitude;this.toPolar()}}};this.subtract=function(e){if(e.Vx!=undefined){this.add({Vx:-e.Vx,Vy:-e.Vy})}else{this.add({magnitude:-e.magnitude,direction:e.direction})}};this.getXcomponent=function(){if(this.Vx!=undefined)return this.Vx;return Math.cos(this.direction)*this.magnitude};this.getYcomponent=function(){if(this.Vy!=undefined)return this.Vy;return Math.sin(this.direction)*this.magnitude};this.getMagnitude=function(){if(this.magnitude!=undefined)return this.magnitude;return Math.sqrt(this.Vx*this.Vx+this.Vy*this.Vy)};this.getDirection=function(){if(this.direction!=undefined)return this.direction;return Math.atan2(this.Vy,this.Vx)}}},physics:{G:6.67384e-11,timeStep:1,applyGravity:function(e,t){var n=false;var i=false;var r=e.x-t.x;var o=e.y-t.y;var s=r*r+o*o;if(s==0)return;if(r<0){n=true;r=-r}if(o<0){i=true;o=-o}var a=Jenjens.physics.G*t.mass/s;if(isFinite(a)){var d=r*a/(r+o);var l=a-d;if(n)d=-d;if(i)l=-l;e.v.x-=d*Jenjens.physics.timeStep;e.v.y-=l*Jenjens.physics.timeStep}a=Jenjens.physics.G*e.mass/s;if(isFinite(a)){d=r*a/(r+o);l=a-d;if(n)d=-d;if(i)l=-l;t.v.x+=d*Jenjens.physics.timeStep;t.v.y+=l*Jenjens.physics.timeStep}},setOrbit:function(e,t,n){var i=false;var r=false;var o=e.x-t.x;var s=e.y-t.y;if(o<0){i=true;o=-o}if(s<0){r=true;s=-s}var a=Math.sqrt(o*o+s*s);var d=Math.sqrt(Jenjens.physics.G*e.mass/a);var l=o*d/(o+s);var c=d-l;if(!n){if(i)l=-l;if(r)c=-c}t.v.x=-c+e.v.x;t.v.y=l+e.v.y},calculateBarycenter:function(){var e={x:0,y:0};var t=0;Jenjens.util.forEach(array,function(n){e.x+=n.mass*n.x;e.y+=n.mass*n.y;t+=n.mass});e.x/=t;e.y/=t;return e},updateLocation:function(e){e.lastX=e.x;e.lastY=e.y;if(e.rotationSpeed!=null){e.lastRotation=e.rotation;e.rotation+=e.rotationSpeed*physics.timeStep;if(e.rotation>0){while(e.rotation>Math.Tau)e.rotation-=Math.Tau}else{while(e.rotation<-Math.Tau)e.rotation+=Math.Tau}}if(e.v.x!=null){e.x+=e.v.x*Jenjens.physics.timeStep;e.y+=e.v.y*Jenjens.physics.timeStep}},radialCollision:function(e,t){var n=e.x-t.x;var i=e.y-t.y;var r=Math.sqrt(n*n+i*i);if(r<e.radius+t.radius)return true;return false},vector:function(e,t,n){if(n){this.x=Math.cos(t)*e;this.y=Math.sin(t)*e}else{e?this.x=e:this.x=0;t?this.y=t:this.y=0}if(e){if(e.x!=undefined){this.x=e.x;this.y=e.y}if(e.Vx!=undefined){this.x=e.Vx;this.y=e.Vy}if(e.magnitude!=undefined){this.x=e.getXcomponent();this.y=e.getYcomponent()}}this.add=function(e){this.x+=e.x;this.y+=e.y};this.subtract=function(e){this.x-=e.x;this.y-=e.y};this.getXcomponent=function(){return e};this.getYcomponent=function(){return t};this.getMagnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};this.getDirection=function(){return Math.atan2(this.y,this.x)}}},string:{pad:function(e,t,n,i){if(n==undefined)n="0";if(t==undefined)throw"string.pad(str,len): len undefined, check your arguments";while(e.length<t){i?e+=n:e=n+e}return e}},random:{number:function(e,t){return Math.random()*(t-e)+e},integer:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},color:"temp value"},render:{canvas:[],context:[],addByID:function(e){Jenjens.render.canvas.push(document.getElementById(e));Jenjens.render.context.push(Jenjens.render.canvas[Jenjens.render.canvas.length-1].getContext("2d"));return{canvas:Jenjens.render.canvas[Jenjens.render.canvas.length-1],context:Jenjens.render.context[Jenjens.render.context.length-1]}}},structure:{Circle:function(e,t,n,i){!e?this.radius=1:this,e=e;!t?this.x=0:this.x=t;!n?this.y=0:this.y=n;!i?this.color=Jenjens.debug.defaultColor:this.color=i;this.fill=function(e){if(!e)e=Jenjens.render.context[0];e.beginPath();e.arc(this.x,this.y,this.radius,0,Jenjens.Math.Tau);e.fillStyle=this.color;e.fill()}}},io:{addEvent:function(e,t,n,i){if(!n)n=window;if(n.addEventListener)n.addEventListener(e,t,i);else if(n.attachEvent)n.attachEvent("on"+e,t);else throw"No method to addEvent."},keysHeld:[],keyDown:function(e){var t=e.keyCode?e.keyCode:e.charCode;io.keysHeld[t]=true},keyUp:function(e){var t=e.keyCode?e.keyCode:e.charCode;io.keysHeld[t]=false},getMouseX:function(e){var t=0;if(e.clientX&&document.body&&document.body.scrollLeft!=null){t=e.clientX+document.body.scrollLeft}else if(e.clientX&&document.compatMode=="CSS1Compat"&&document.documentElement&&document.documentElement.scrollLeft!=null){t=e.clientX+document.documentElement.scrollLeft}else if(e.pageX){t=e.pageX}return t},getMouseY:function(e){var t=0;if(e.clientY&&document.body&&document.body.scrollTop!=null){t=e.clientY+document.body.scrollTop}else if(e.clientY&&document.compatMode=="CSS1Compat"&&document.documentElement&&document.documentElement.scrollTop!=null){t=e.clientY+document.documentElement.scrollTop}else if(e.pageY){t=e.pageY}return t}},util:{forEach:function(e,t){for(var n=0;n<e.length;n++)t(e[n])},forEachCompare:function(e,t){for(var n=0;n<e.length-1;n++)for(var i=n+1;i<e.length;i++)t(e[n],e[i])},addEventHandler:function(e,t,n,i){if(e.addEventListener)e.addEventListener(t,n,i);else if(e.attachEvent)e.attachEvent("on"+t,n);else throw"No method to addEvent."},cancelBubble:function(e){var t=e?e:window.event;if(t.stopPropagation)t.stopPropagation();if(t.cancelBubble!=null)t.cancelBubble=true},Interval:function(e,t){this.funct=e;this.timing=t;this.id=null;this.running=false;this.start=function(){if(!this.running){this.id=setInterval(this.funct,this.timing);this.running=true}};this.stop=function(){if(this.running){clearInterval(this.id);this.running=false}};this.incDelay=function(e){if(e==undefined)e=1;this.timing+=e;if(this.running)this.restart()};this.decDelay=function(e){if(e==undefined)e=1;this.timing-=e;if(this.running)this.restart()};this.restart=function(){if(this.running)clearInterval(this.id);this.id=setInterval(this.funct,this.timing);this.running=true}},Timer:{set:function(e,t){return setTimeout(e,t)},cancel:function(e){clearTimeout(e)}}},debug:{engineVersion:.08,defaultColor:"#FFF",showClicks:function(e){var t=Jenjens.io.getMouseX(e);var n=Jenjens.io.getMouseY(e);switch(e.button){case 0:Jenjens.render.context[0].fillStyle="#F00";break;case 1:Jenjens.render.context[0].fillStyle="#0F0";break;case 2:Jenjens.render.context[0].fillStyle="#00F";break;default:Jenjens.render.context[0].fillStyle="#FFF";console.log("Jenjens.io.debug.showClicks(): unrecognized mouse button: "+e.button,"4/5 are usually back/forward buttons.")}Jenjens.render.context[0].beginPath();Jenjens.render.context[0].arc(t,n,1,0,Jenjens.Math.Tau);Jenjens.render.context[0].fill()}}};color=Jenjens.color;Jenjens.color.random=Jenjens.random.color;Math.Tau=Jenjens.Math.Tau;Math.getDistance=Jenjens.Math.getDistance;Math.toDegrees=Jenjens.Math.toDegrees;Math.toRadians=Jenjens.Math.toRadians;Vector=Jenjens.Math.Vector;physics=Jenjens.physics;vector=Jenjens.physics.vector;string=Jenjens.string;random=Jenjens.random;render=Jenjens.render;Circle=Jenjens.structure.Circle;io=Jenjens.io;forEach=Jenjens.util.forEach;forEach2=Jenjens.util.forEach2;forEachCompare=Jenjens.util.forEachCompare;addEventHandler=Jenjens.util.addEventHandler;Interval=Jenjens.util.Interval;Timer=Jenjens.util.Timer;debug=Jenjens.debug;console.log("GUI loading.");var gui={inspectorEnabled:false};var GUI={load:function(){if(typeof dat==="undefined"||typeof Game==="undefined"||typeof Game.system==="undefined"||typeof Render==="undefined"){console.log("GUI not ready.");setTimeout(GUI.load,100);return}gui.main=new dat.GUI;gui.main.remember(Game);gui.main.remember(Render);gui.main.remember(physics);gui.main.add(Game.system,"focusID").name("Player Focus ID");gui.functions=gui.main.addFolder("Functions");gui.functions.add(Game,"running").onChange(function(e){if(e)Game.loop()});gui.functions.add(Game,"generateNewSystem").name("New System").onChange(function(){Render.redraw()});gui.functions.add(Game,"generateAsteroids").name("Random Asteroids");gui.functions.add(gui,"inspectorEnabled").onChange(function(){if(gui.inspectorEnabled)GUI.activateInspector();else gui.inspector.destroy()});gui.render=gui.main.addFolder("Render Settings");gui.render.add(Render,"iterationDelay",{Max:1,60:17,30:33,10:100,Min:2e3}).name("FPS");gui.render.add(Render,"renderType",{normal:"normal","pseudo 3D":"3D","1D":"side"}).onChange(function(){Render.redraw()});gui.render.add(Render,"angle3D",0,360).step(1).name("3D Angle").onChange(function(){Render.redraw()});gui.render.add(Render,"fade");gui.render.add(Render,"fadeAlpha",.01,1).step(.01);gui.render.add(Render,"focusType",["body","ship"]).onChange(function(){Render.redraw()});gui.render.add(Render,"focusID").name("Render Focus ID").onChange(function(){Render.redraw()});gui.render.add(Render,"scale",.5,10).step(.1).name("Scale (close)").onChange(function(){Render.redraw()});gui.render.add(Render,"scale",.001,.05).step(.001).name("Scale (med)").onChange(function(){Render.redraw()});gui.render.add(Render,"scale",1e-4,.001).step(1e-4).name("Scale (far)").onChange(function(){Render.redraw()});gui.render.add(Render,"minRadius",.1,1).step(.1);gui.physics=gui.main.addFolder("Physics Settings");gui.physics.add(physics,"G",.1,5).step(.1).name("Grav Constant");gui.physics.add(physics,"timeStep",.1,5).step(.1);console.log("GUI loaded.")},activateInspector:function(){gui.inspector=new dat.GUI;io.addEvent("mousedown",function(e){var t=io.getMouseX(e);var n=io.getMouseY(e)})}};GUI.load();console.log("Images loading.");var Images={fx:{rcs:new Image}};Images.fx.rcs.onerror=function(){Images.error=true};Images.fx.rcs.src="img/fx/rcs.png";Images.loaded=setInterval(function(){var e=true;for(x in Images){for(y in Images[x])if(!Images[x][y].complete)e=false}if(e){clearInterval(Images.loaded);if(Images.error){Images.loaded=false;console.log("Error loading images.")}else{Images.loaded=true;console.log("Images loaded.")}return}console.log("Images not ready.")},100);console.log("IO loading.");io.addEvent("load",function(){io.addEvent("keydown",io.keyDown,Render.canvas);io.addEvent("keyup",io.keyUp,Render.canvas)});function checkInput(){if(io.keysHeld[87])Game.system.ships[Game.system.focusID].v.y-=1;if(io.keysHeld[65])Game.system.ships[Game.system.focusID].v.x-=1;if(io.keysHeld[83])Game.system.ships[Game.system.focusID].v.y+=1;if(io.keysHeld[68])Game.system.ships[Game.system.focusID].v.x+=1;if(io.keysHeld[38])Game.system.ships[Game.system.focusID].v.y-=1;if(io.keysHeld[37])Game.system.ships[Game.system.focusID].v.x-=1;if(io.keysHeld[40])Game.system.ships[Game.system.focusID].v.y+=1;if(io.keysHeld[39])Game.system.ships[Game.system.focusID].v.x+=1}console.log("IO loaded.");var Game={start:function(){Game.gui.destroy();Game.generateNewSystem();Game.temporaryShittyShip();Game.loop()},running:true,gui:null,generateNewSystem:function(){Render.clear(true);Game.system=new System(2)},temporaryShittyShip:function(){Game.system.ships[0]={Parts:[{color:[255,255,0,1],height:8,mass:4.512,name:"tank",rotation:.1,type:"Tank",width:4,x:-1,y:0},{color:[255,0,0,.8],height:4,mass:4.512,name:"tank",rotation:Math.Tau/4-.1,type:"Tank",width:8,x:1,y:0}],name:"test",rotation:0,rotationSpeed:0,type:"Ship",v:new physics.vector,x:250,y:0};physics.setOrbit(Game.system.bodies[0],Game.system.ships[0])},generateAsteroids:function(){var e=random.integer(1,5);for(var t=0;t<e;t++){var n=random.integer(21,169);var i=random.number(0,Render.canvas.width*2/Render.scale);var r=random.number(0,Math.Tau);var o=new Planetoid(random.number(.5,40),Math.cos(r)*i,Math.sin(r)*i,[n,n,n,1],0,"asteroid");physics.setOrbit(Game.system.bodies[0],o);Game.system.bodies.push(o)}},loop:function(){forEachCompare(Game.system.bodies,function(e,t){if(physics.radialCollision(e,t))physics.combine(e,t)});forEachCompare(Game.system.bodies,function(e,t){physics.applyGravity(e,t)});forEachCompare(Game.system.ships,function(e,t){physics.applyGravity(e,t)});forEach(Game.system.bodies,function(e){forEach(Game.system.ships,function(t){physics.applyGravity(e,t)})});Render.clear();if(Images.loaded===true)Render.context.drawImage(Images.fx.rcs,100,100);forEach(Game.system.bodies,function(e){physics.updateLocation(e);Render.draw(e)});checkInput();forEach(Game.system.ships,function(e){physics.updateLocation(e);Render.draw(e)});if(Game.running)setTimeout(Game.loop,Render.iterationDelay)}};function load(){if(typeof Game==="undefined"||typeof Render==="undefined"||typeof Render.canvas==="undefined"){console.log("Not ready. (function: load)");setTimeout(load,100);return}console.log("Game loaded. (function: load)");Game.gui=new dat.GUI;Game.gui.add(Game,"start").name("Start Simulation");Game.start()}io.addEvent("load",load);var System=function(e){this.focusID=0;this.ships=[];this.bodies=[];this.bodies.push(new Star(0,0,0,"star"));var t;for(var n=1;n<e;n++){var i=random.number(this.bodies[0].radius*1.1,Render.canvas.width/Render.scale);var r=random.number(0,Math.Tau);var o=Math.cos(r)*i;var s=Math.sin(r)*i;var a=random.integer(0,3);switch(a){case 0:t=new Planet(o,s,0,"planet");break;case 1:t=new Moon(o,s,0,"moon");break;case 2:t=new Asteroid(o,s,0,"asteroid");break;case 3:t=new GasGiant(o,s,0,"giant");break}physics.setOrbit(this.bodies[0],t);
this.bodies.push(t)}};console.log("Constructors (objects.js) loading.");if(typeof physics==="undefined"){console.log("Error loading constructors, physics not loaded.");alert("Error loading physics. Contact Guard13007.")}var Body=function(e,t,n,i){e?this.x=e:this.x=0;t?this.y=t:this.y=0;n?this.rotationSpeed=n:this.rotationSpeed=0;this.rotation=0;this.v=new physics.vector;this.type="Body";i?this.name=i:this.name="unnamed";this.mass=0};Body.prototype.getVelocity=function(){};Body.prototype.getOriginDistance=function(){};var Planetoid=function(e,t,n,i,r,o){Body.call(this,t,n,r,o);this.type="Planetoid";e?this.radius=e:this.radius=1;this.mass=Math.pow(this.radius,physics.PlanetoidDensity);i?this.color=i:this.color=[255,255,255,1]};var Asteroid=function(e,t,n,i){var r=random.integer(21,169);Planetoid.call(this,random.number(.5,40),e,t,[r,r,r,1],n,i);this.type="Asteroid"};var Moon=function(e,t,n,i){var r=[255,255,255,1];Planetoid.call(this,random.number(81,149),e,t,r,n,i);this.type="Moon"};var Planet=function(e,t,n,i){var r=[255,255,255,1];Planetoid.call(this,random.number(289,404),e,t,r,n,i);this.type="Planet"};var GasGiant=function(e,t,n,i){var r=[255,255,255,1];Planetoid.call(this,random.number(666,1313),e,t,r,n,i);this.type="GasGiant"};var Star=function(e,t,n,i){var r,o,s;var a=random.integer(0,32);if(a<=16){r=random.integer(228,255);o=random.integer(0,10);s=random.integer(0,10)}else if(a>=17&&a<=24){r=random.integer(228,255);o=r+random.integer(-3,3);if(o>255)o=255;s=random.integer(0,10)}else if(a>=25&&a<=27){r=random.integer(0,10);o=random.integer(0,10);s=random.integer(200,255)}else if(a>=28&&a<=31){r=random.integer(200,255);o=random.integer(165,255);s=random.integer(0,10)}else if(a==32){r=random.integer(0,10);o=random.integer(228,255);s=o+random.integer(-3,3);if(s>255)s=255}var d=[r,o,s,1];Planetoid.call(this,random.number(6e3,13e3),e,t,d,n,i);this.type="Star"};var Ship=function(e,t,n,i,r,o){Body.call(this,t,n,r,o);this.type="Ship";this.Parts=e.Parts;this.mass=e.mass;this.centerOfMass=e.centerOfMass;i?this.rotation=i:this.rotation=0};Ship.prototype.updateMass=function(){var e=0;forEach(this.Parts,function(t){e+=t.mass});if(isNaN(e))e=0;this.mass=e};Ship.prototype.updateCenterOfMass=function(){var e=0;var t=0;var n=0;forEach(this.Parts,function(i){e+=i.x*i.mass;t+=i.y*i.mass;n+=i.mass});this.centerOfMass={x:e/n,y:t/n};if(isNaN(this.centerOfMass.x))this.centerOfMass.x=0;if(isNaN(this.centerOfMass.y))this.centerOfMass.y=0};console.log("Constructors (objects.js) loaded.");console.log("Custom physics loading.");if(typeof physics==="undefined"){console.log("Error loading physics.");alert("Error loading physics. Contact Guard13007.")}physics.G=5;physics.timeStep=5;physics.PlanetoidDensity=2.7;physics.setOrbit=function(e,t,n){var i=false;var r=false;var o=e.x-t.x;var s=e.y-t.y;if(o<0){i=true;o=-o}if(s<0){r=true;s=-s}var a=Math.sqrt(o*o+s*s);var d=Math.sqrt(physics.G*(e.mass+t.mass)/a);var l=o*d/(o+s);var c=d-l;if(!n){if(i)l=-l;if(r)c=-c}t.v.x=-c+e.v.x;t.v.y=l+e.v.y};physics.combine=function(e,t){if(t.mass>e.mass){e.name=t.name;e.color=t.color}if(Render.focusType=="body"&&Render.focusID==Game.system.bodies.indexOf(t))Render.focusID=Game.system.bodies.indexOf(e);var n=e.x*e.mass+t.x*t.mass;var i=e.y*e.mass+t.y*t.mass;var r=e.v.x*e.mass+t.v.x*t.mass;var o=e.v.y*e.mass+t.v.y*t.mass;e.mass+=t.mass;e.v.x=r/e.mass;e.v.y=o/e.mass;e.radius=Math.pow(e.mass,1/2.7);e.x=n/e.mass;e.y=i/e.mass;Game.system.bodies.splice(Game.system.bodies.indexOf(t),1)};console.log("Custom physics loaded.");console.log("Render loading.");var Render={iterationDelay:1,renderType:"normal",angle3D:145,fade:true,fadeAlpha:.01,focusType:"body",focusID:0,scale:5e-4,minRadius:.3,clear:function(e){if(e||!Render.fade){Render.context.clearRect(0,0,Render.canvas.width,Render.canvas.height)}else{Render.context.fillStyle="rgba(0,0,0,"+Render.fadeAlpha+")";Render.context.fillRect(0,0,Render.canvas.width,Render.canvas.height)}},draw:function(e){if(Render.renderType=="normal"){if(Render.focusType=="body"&&Game.system.bodies[Render.focusID]){var t=(e.x-Game.system.bodies[Render.focusID].x)*Render.scale+Render.canvas.width/2;var n=(e.y-Game.system.bodies[Render.focusID].y)*Render.scale+Render.canvas.height/2}else if(Render.focusType=="ship"&&Game.system.ships[Render.focusID]){var t=(e.x-Game.system.ships[Render.focusID].x)*Render.scale+Render.canvas.width/2;var n=(e.y-Game.system.ships[Render.focusID].y)*Render.scale+Render.canvas.height/2}else{console.log("Invalid Render settings, rendering at Origin.");var t=0;var n=0}}else if(Render.renderType=="3D"){if(Render.focusType=="body"&&Game.system.bodies[Render.focusID]){var i=(e.x-Game.system.bodies[Render.focusID].x)*Render.scale;var r=(e.y-Game.system.bodies[Render.focusID].y)*Render.scale}else if(Render.focusType=="ship"&&Game.system.ships[Render.focusID]){var i=(e.x-Game.system.bodies[Render.focusID].x)*Render.scale;var r=(e.y-Game.system.bodies[Render.focusID].y)*Render.scale}else{console.log("Invalid Render settings, rendering at Origin.");var t=0;var n=0}var t=i*Math.cos(Math.toRadians(Render.angle3D))-r*Math.sin(Math.toRadians(Render.angle3D))+Render.canvas.width/2;var n=r*Math.sin(Math.toRadians(Render.angle3D))+r*Math.cos(Math.toRadians(Render.angle3D))+Render.canvas.height/2}else if(Render.renderType=="side"){var t=(e.x-Game.system.bodies[Render.focusID].x)*Render.scale+Render.canvas.width/2;var n=Render.canvas.height/2}if(e.type=="Planetoid"||e.type=="Asteroid"||e.type=="Moon"||e.type=="Planet"||e.type=="GasGiant"||e.type=="Star"){Render.context.beginPath();Render.context.fillStyle="rgba("+e.color[0]+","+e.color[1]+","+e.color[2]+","+e.color[3]+")";var o=e.radius*Render.scale;if(o<Render.minRadius)o=Render.minRadius;Render.context.arc(t,n,o,0,Math.Tau);Render.context.fill()}else if(e.type=="Ship"){Render.context.translate(t,n);Render.context.rotate(e.rotation);forEach(e.Parts,function(e){Render.context.beginPath();Render.context.fillStyle="rgba("+e.color[0]+","+e.color[1]+","+e.color[2]+","+e.color[3]+")";Render.context.translate(e.x*Render.scale,e.y*Render.scale);Render.context.rotate(e.rotation);Render.context.fillRect(-e.width*Render.scale/2,-e.height*Render.scale/2,e.width*Render.scale,e.height*Render.scale);Render.context.rotate(-e.rotation);Render.context.translate(-e.x*Render.scale,-e.y*Render.scale)});Render.context.rotate(-e.rotation);Render.context.translate(-t,-n)}else{console.log("Invalid Body type:",e)}},redraw:function(){Render.clear(true);forEach(Game.system.bodies,function(e){Render.draw(e)});forEach(Game.system.ships,function(e){Render.draw(e)})},drawPlanetoid:function(){},drawShip:function(e){}};io.addEvent("load",function(){Render.canvas=document.getElementById("canvas");Render.canvas.width=window.innerWidth;Render.canvas.height=window.innerHeight;Render.context=Render.canvas.getContext("2d");console.log("Render loaded.")});io.addEvent("resize",function(){Render.canvas.width=window.innerWidth;Render.canvas.height=window.innerHeight});var Vessel=function(e,t){e?this.Parts=e:this.Parts=[];this.type="Vessel";t?this.name=t:this.name="unnamed";this.mass=0;this.centerOfMass={x:0,y:0}};Vessel.prototype.updateMass=Ship.prototype.updateMass;Vessel.prototype.updateCenterOfMass=Ship.prototype.updateCenterOfMass;var Part=function(e,t,n){this.type="Part";e?this.mass=e:this.mass=0;t?this.color=t:this.color=[255,255,255,1];n?this.name=n:this.name="unnamed"};var Tank=function(e,t,n,i){e?this.width=e:this.width=1;t?this.height=t:this.height=1;Part.call(this,.141*this.width*this.height/10,n,i);this.type="Tank";this.massCapacity=.141*this.width*this.height*.9};var Fuel=function(e){e?this.density=e:this.density=1};liquidOxygen=new Fuel(.141);